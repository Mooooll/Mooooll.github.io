import{_ as U,y as D,r as p,z as q,o as Y,e as w,f as _,i as G,w as W,k as v,g as s,u as i,t as O,v as k,T as Z,q as j,a as P,F as N,h as F,A as ee,B as te,C as ne,D as le,E as ae,j as oe,p as re,n as ie}from"./index-9d984574.js";import{t as se}from"./type-a1476f67.js";import{m as B}from"./mes-529db3de.js";import"./utils-e9459a86.js";const ce=["id"],ue={class:"absolute top-0 left-0 w-full h-full bg-neutral-50/70 dark:bg-neutral-900/70 flex flex-wrap overflow-hidden"},de=["id"],fe=["value"],pe={__name:"player",props:{player:{type:Object,default:()=>{}},cnn:{type:Boolean,default:!1},headcount:{type:Number,default:2},working:{type:Boolean,default:!1}},emits:["change","lose","win","get-out","nothing","enqueue"],setup(u,{emit:h}){const a=u,e=c=>{let d=c.target.value;d.length>10&&(B({type:"error",text:"少点字儿吧",time:2e3}),d=c.target.value=d.slice(0,10).trim()),h("change",d,a.player.id)};D(()=>a.cnn,(c,d)=>{!c&&a.player.nickname.length<=0&&(B({type:"error",text:"昵称怎么能空着呢",time:2e3}),h("change",`昵称${a.player.id.slice(-6)}`,a.player.id))});let r=p(!1),y=p(!1),m=q(()=>`dapai${a.player.id}`),E=q(()=>`tc${a.player.id}`),I=q(()=>!a.cnn&&!r.value&&!a.player.bedoing),o=c=>{let d=document.getElementById(m.value);d&&(d.contains(c.target)&&!a.player.bedoing&&!y.value&&r.value?y.value=!0:(r.value=!1,y.value=!1))};D(r,(c,d)=>{setTimeout(()=>{c?window.addEventListener("click",o):window.removeEventListener("click",o)},0)});const L=()=>{a.cnn||a.player.bedoing||(a.working?h("enqueue",a.player.id):r.value=!0)},S=()=>{h("lose",a.player.nickname,a.player.id)},x=()=>{h("win",a.player.nickname,a.player.id)},$=async()=>{if(a.headcount<=2){B({type:"error",text:"玩家人数过少",time:2e3}),r.value=!1;return}y.value&&h("get-out",a.player.nickname,a.player.id,a.player.jetton)},g=()=>{h("nothing",a.player.nickname,a.player.id)};return Y(()=>{window.removeEventListener("click",o)}),(c,d)=>(w(),_("div",{onClickCapture:L,id:i(m),class:j(["relative w-5/12 md:w-1/3 min-h-24 border select-none transition-all flex justify-center items-center flex-col gap-2",{"cursor-pointer":i(I)},u.player.bedoing?"opacity-60 cursor-not-allowed border-purple-600":a.player.me?"border-amber-600":""])},[G(Z,{name:"fade"},{default:W(()=>[v(s("div",ue,[s("div",{onClick:S,class:"doing-btn border-r border-b cursor-pointer"},"支出"),s("div",{onClick:x,class:"doing-btn border-l border-b cursor-pointer"},"通吃"),s("div",{onClick:$,id:i(E),class:"doing-btn border-r border-t cursor-pointer"},O(i(y)?"确认":"退出"),9,de),s("div",{onClick:g,class:"doing-btn border-l border-t"})],512),[[k,i(r)]])]),_:1}),v(s("span",{class:"basis-1/3 text-2xl w-3/4 flex justify-center items-center"},O(u.player.nickname),513),[[k,!u.cnn]]),v(s("input",{type:"text",value:u.player.nickname,onInput:e,class:"basis-1/3 text-2xl text-center w-full border-none outline-none p-0 bg-white dark:bg-neutral-900"},null,40,fe),[[k,u.cnn]]),s("span",{class:j(["break-all text-center",u.player.jetton>0?"text-emerald-500 dark:text-emerald-300":u.player.jetton==0?"":"text-rose-600 dark:text-rose-500"])},O(u.player.jetton),3)],42,ce))}},he=U(pe,[["__scopeId","data-v-dfdec515"]]);const ge=u=>(re("data-v-ca6d7f4e"),u=u(),ie(),u),ve={key:0,class:"min-h-[80vh] text-2xl flex flex-col justify-center items-center gap-8"},ye={class:"relative w-9/12 max-w-xs flex flex-wrap justify-evenly gap-2"},me=["onClick"],xe={key:1,class:"w-full flex flex-col items-center"},be={class:"btnbox w-full max-w-5xl flex justify-evenly items-start gap-2 select-none"},we={class:"fixed top-0 left-0 w-full max-w-5xl h-full p-2 bg-neutral-800/20"},ke=["placeholder","onKeyup"],_e={class:"w-full max-w-5xl my-6 flex flex-col justify-start items-center gap-2"},$e=ge(()=>s("div",{class:"text-lg"},"历史",-1)),Ce={class:"w-full p-2 text-center"},je={__name:"dapai",setup(u){let h=p(!1),a=p(2),e=P([]),r=p(!1);const y=l=>{a.value=l,h.value=!0;for(let n=0;n<l;n++)e.push({id:n.toString(),nickname:`好运${n+1}号`,jetton:0,bedoing:!1,me:!1})};let m=p(!1);const E=()=>{if(r.value){B({type:"error",text:"非法操作",time:2e3});return}m.value=!0},I=()=>{m.value=!1,o.length>0&&o[0]!=""&&b.unshift(`"${o[o.length-1]}" 改名为 "${o[0]}"`),o=[]};let o=[];const L=(l,n)=>{let t=e.indexOf(e.find(C=>C.id==n));o.length>=2&&(e[t].nickname==o[0]?(o.shift(),o.unshift(l)):(b.unshift(`"${o[o.length-1]}" 改名为 "${o[0]}"`),o.length=0)),o.length==0&&(o.unshift(e[t].nickname),o.unshift(l)),e[t].nickname=l},S=()=>{if(r.value){B({type:"error",text:"非法操作",time:2e3});return}e.push({id:new Date().getTime().toString(),nickname:`天问${e.length+1}号`,jetton:0,bedoing:!1,me:!1}),a.value++,b.unshift(`"天问${e.length}号" 加入`)};let x=p(0),$=p("");D(x,(l,n)=>{switch(x.value){case 1:$.value="支出点数";break;case 2:$.value="通吃点数";break;default:$.value="点数";break}});let g;const c=[];let d=p(null);const A=(l,n)=>{r.value=!0,x.value=1;for(let t=0;t<e.length;t++)e[t].id===n&&(e[t].bedoing=!0,g=t)},H=l=>{for(let n=0;n<e.length;n++)e[n].id===l&&(e[n].me=!e[n].me)};let T=p(!1),f=p();D(f,(l,n)=>{l>999&&(f.value=999)});const M=()=>{if(!r.value){B({type:"warn",text:"温馨提示：用于确认收款人",time:2e3});return}for(let l=0;l<e.length;l++)e[l].me===!0&&c.push(e[l].id);for(let l=0;l<e.length&&e[l].me!=!0;l++)if(l>=e.length-1){z();return}T.value=!0,K()},R=(l,n)=>{r.value=!0,x.value=2;for(let t=0;t<e.length;t++)e[t].id===n&&(e[t].bedoing=!0,g=t);T.value=!0,K()},J=(l,n,t)=>{e.splice(e.indexOf(e.find(C=>C.id==n)),1),a.value--,b.unshift(`"${l}" 退出 金额为 ${t}`)},Q=(l,n)=>{for(let t=0;t<e.length;t++)e[t].id===n&&(e[t].bedoing=!0,setTimeout(()=>{e[t].bedoing=!1},0))},X=()=>{switch(x.value){case 1:let l=[];for(let n=0;n<c.length;n++){let t=e.indexOf(e.find(C=>C.id==c[n]));e[t].jetton+=f.value,e[t].me=!1,l.push(e[t].nickname)}e[g].jetton-=f.value*c.length,V(e[g].nickname,f.value,l);break;case 2:for(let n=0;n<e.length;n++)e[n].jetton-=f.value;e[g].jetton+=f.value*a.value,V(e[g].nickname,f.value);break}z()},K=async()=>{await ae(),d.value.focus()},b=P([]),V=(l,n,t)=>{switch(x.value){case 1:b.unshift(`${l} 支付给 ${t} ${n}`);break;case 2:b.unshift(`${l} 通吃 ${n}`);break;default:console.error("???");break}},z=()=>{f.value="",T.value=!1,c.length=0,r.value=!1,e[g].bedoing=!1,g=-1};return(l,n)=>i(h)?(w(),_("div",xe,[G(ee,{name:"list",tag:"div",class:"playerbox w-full max-w-5xl min-h-[80vh] mt-1 mb-8 flex flex-wrap justify-around gap-y-2"},{default:W(()=>[(w(!0),_(N,null,F(i(e),t=>(w(),oe(he,{key:t,player:t,cnn:i(m),headcount:i(a),working:i(r),onChange:L,onLose:A,onWin:R,onGetOut:J,onNothing:Q,onEnqueue:H},null,8,["player","cnn","headcount","working"]))),128))]),_:1}),s("div",be,[v(s("div",{onClick:E,class:j(["btn",i(r)?"opacity-50 cursor-not-allowed":"cursor-pointer"])}," 修改昵称",2),[[k,!i(m)]]),v(s("div",{onClick:I,class:j(["btn",i(r)?"opacity-50 cursor-not-allowed":"cursor-pointer"])}," 完成 ",2),[[k,i(m)]]),v(s("div",{onClick:S,class:j(["btn",i(r)?"opacity-50 cursor-not-allowed":"cursor-pointer"])},"加入 ",2),[[k,i(a)<10]]),s("div",{onClick:M,class:j(["btn",i(r)?"cursor-pointer":"opacity-50 cursor-not-allowed"])},"确认",2)]),v(s("div",we,[v(s("input",{ref_key:"iptPaying",ref:d,type:"number",pattern:"\\d*",placeholder:i($),"onUpdate:modelValue":n[0]||(n[0]=t=>te(f)?f.value=t:f=t),onKeyup:ne(X,["enter"]),class:"mt-12 text-2xl text-center w-full border-none rounded-lg outline-none py-2 bg-white/90 dark:bg-neutral-900/90"},null,40,ke),[[le,i(f)]])],512),[[k,i(T)]]),v(s("div",_e,[$e,(w(!0),_(N,null,F(b,t=>(w(),_("div",Ce,O(t),1))),256))],512),[[k,b.length>0]])])):(w(),_("div",ve,[G(se,{list:["请选择参与人数"],loop:!1,speed:50}),s("div",ye,[(w(),_(N,null,F(9,t=>s("div",{key:t,onClick:C=>y(t+1),class:"w-1/4 text-center leading-10 hover:text-yali-yel cursor-pointer transition-all duration-300 border border-dotted select-none"},O(t+1),9,me)),64))])]))}},Ee=U(je,[["__scopeId","data-v-ca6d7f4e"]]);export{Ee as default};
