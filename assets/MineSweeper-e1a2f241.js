import{_ as h,e as c,f as d,m as p}from"./index-720d723d.js";const f={data(){return{oGame:null,oTemp:null,map:[],state:"loading",row:9,col:9,mines:10,mapCount:0,mapTimer:null,startTime:0,startTimer:null}},methods:{initMap(e=9,t=9,s=10){this.map=[],this.row=e,this.col=t,this.mines=s,this.state="loading",document.getElementById("mines").innerHTML=this.mines,clearInterval(this.startTimer),document.getElementById("timer").innerHTML="00:00",this.oGame.className="",this.oGame.innerHTML="",document.documentElement.style.setProperty("--base",e>9?"2.4":"2"),document.documentElement.style.setProperty("--row",e),document.documentElement.style.setProperty("--col",t),clearInterval(this.mapTimer),this.mapCount=0,this.mapTimer=setInterval(()=>{if(this.mapCount>=e)return this.state="loaded",this.generateMines(),clearInterval(this.mapTimer);const i=document.createDocumentFragment(),o=[];for(let a=0;a<t;a++){const n=document.createElement("div");n.className="state-loading",n.addEventListener("animationend",function l(){n.className="state-closed",n.removeEventListener("animationend",l)}),n.pos=[this.mapCount,a],o.push({isOpen:!1,isCheck:!1,isExplode:!1,sign:"normal",type:0}),i.appendChild(n)}this.map.push(o),this.oGame.appendChild(i),this.mapCount++},100)},findPos([e,t]){return[[e-1,t-1],[e-1,t],[e-1,t+1],[e,t-1],[e,t+1],[e+1,t-1],[e+1,t],[e+1,t+1]].filter(([i,o])=>!(i<0||o<0||i>=this.row||o>=this.col))},findPosUDLR([e,t]){return[[e-1,t],[e+1,t],[e,t-1],[e,t+1]].filter(([i,o])=>!(i<0||o<0||i>=this.row||o>=this.col))},generateMines(){let e=[];for(;e.length!==this.mines;)e=[...new Set([...e,Math.floor(Math.random()*this.row*this.col)])];for(let t=0;t<e.length;t++){const s=Math.floor(e[t]/this.col),i=e[t]%this.col;e[t]=[s,i],this.map[s][i].type=9}for(let t=0;t<e.length;t++){const s=this.findPos(e[t]);for(let i=0;i<s.length;i++){const o=this.map[s[i][0]][s[i][1]];o.type!==9&&o.type++}}},handleClick(e){this.state!=="ongoing"&&(this.state="ongoing",this.startTime=+new Date,this.startInterval());const t=this.map[e.pos[0]][e.pos[1]];t.isOpen=!0,t.isCheck=!0,e.className="state-"+t.type,t.type===0?this.handleSpace(e.pos):t.type===9&&this.handleMines([e.pos]),this.judgeVictory()},explodeMines(e){setTimeout(()=>{if(this.map.length==0)return;const t=this.findPosUDLR(e);for(let s=0;s<t.length;s++){const[i,o]=t[s],a=this.map[i][o];if(a.isExplode===!1&&a.sign!=="flag"){a.isExplode=!0;const n=this.oGame.children[i*this.col+o];a.type===9?(a.isOpen=!0,n.className="state-over"):a.isOpen||(n.className="state-explode",n.addEventListener("animationend",function l(){n.className="state-closed",n.removeEventListener("animationend",l)})),this.explodeMines(t[s])}}},100)},handleMines(e){this.state="over",this.oGame.className="fail",clearInterval(this.startTimer);for(let t=0;t<this.map.length;t++)for(let s=0;s<this.map[t].length;s++)this.map[t][s].type===9&&this.map[t][s].sign!=="flag"&&(this.oGame.children[t*this.col+s].className="state-9"),this.map[t][s].type!==9&&this.map[t][s].sign==="flag"&&(this.oGame.children[t*this.col+s].className="state-flag-error");for(let t=0;t<e.length;t++){const[s,i]=e[t],o=this.map[s][i];o.isOpen=!0,o.isExplode=!0;const a=this.oGame.children[s*this.col+i];a.className="state-over";let n=this;a.addEventListener("animationend",function l(){n.explodeMines(e[t]),a.removeEventListener("animationend",l)})}},handleSpace(e){const t=this.findPos(e);for(let s=0;s<t.length;s++){const[i,o]=t[s],a=this.map[i][o];if(a.isCheck===!1&&a.sign==="normal"){a.isOpen=!0,a.isCheck=!0;const n=this.oGame.children[i*this.col+o];if(n.className="state-"+a.sign+"-down",n.addEventListener("animationend",function l(){n.className="state-"+a.type,n.removeEventListener("animationend",l)}),a.type>0&&a.type<9)continue;a.type===0&&this.handleSpace(t[s])}}},handleNumber(e,t){const s=this.findPos(e);let i=0;const o=[],a=[];for(let n=0;n<s.length;n++){const[l,r]=s[n],m=this.map[l][r];m.sign==="flag"&&(i++,o.push({...m,pos:s[n]})),m.type===9&&a.push({...m,pos:s[n]})}if(i>=t)if(JSON.stringify(o)===JSON.stringify(a))this.handleSpace(e);else{for(let n=0;n<o.length;n++)o[n].type!==9&&(this.oGame.children[o[n].pos[0]*this.col+o[n].pos[1]].className="state-flag-error");this.handleMines(a.filter(n=>n.sign!=="flag").map(n=>n.pos))}},judgeVictory(){let e=0,t=0;for(let s=0;s<this.map.length;s++)for(let i=0;i<this.map[s].length;i++)this.map[s][i].isOpen===!1&&e++,this.map[s][i].sign==="flag"&&t++;e===t+this.mines&&(this.state="over",this.oGame.className="success",clearInterval(this.startTimer))},startInterval(){const e=document.getElementById("timer");this.startTimer=setInterval(()=>{const t=Math.floor((+new Date-this.startTime)/1e3),s=Math.floor(t/60)<10?"0"+Math.floor(t/60):Math.floor(t/60),i=t%60<10?"0"+t%60:t%60;e.innerHTML=s+":"+i},1e3)}},created(){},mounted(){this.oGame=document.getElementById("game"),this.initMap(),document.getElementById("simple").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap()}),document.getElementById("medium").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap(16,16,40)}),document.getElementById("hard").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap(16,30,99)}),document.oncontextmenu=()=>!1,this.oGame.addEventListener("mousedown",e=>{if(this.oGame===e.target||["loading","over"].includes(this.state))return;const[t,s]=e.target.pos;this.map[t][s].isOpen===!1?(this.oTemp=e.target,this.oTemp.className="state-"+this.map[t][s].sign+"-down"):console.log("kajshfjh")}),this.oGame.addEventListener("mousemove",e=>{this.oTemp&&this.oTemp!==e.target&&(this.oTemp.className.match(/state\-.+\-down/)&&(this.oTemp.className=this.oTemp.className.replace("-down","-up")),this.oTemp=null)}),this.oGame.addEventListener("mouseup",e=>{if(this.oTemp!==e.target){this.oTemp=null;return}const[t,s]=e.target.pos;e.button===0&&(this.map[t][s].sign==="normal"?this.handleClick(this.oTemp):this.oTemp.className="state-"+this.map[t][s].sign+"-up"),e.button===2&&(this.map[t][s].sign={flag:"question",normal:"flag",question:"normal"}[this.map[t][s].sign],this.map[t][s].sign==="flag"&&(this.mines-=1),this.map[t][s].sign==="question"&&(this.mines+=1),document.getElementById("mines").innerHTML=this.mines,this.oTemp.className="state-"+this.map[t][s].sign+"-up"),this.oTemp=null}),this.oGame.addEventListener("dblclick",e=>{if(this.oGame===e.target)return;const[t,s]=e.target.pos,i=this.map[t][s];i.isOpen&&i.type>0&&i.type<9&&(this.handleNumber([t,s],i.type),this.judgeVictory())})}},g={class:"minesweeper",id:"root"},u=p('<div class="action"><div id="simple"></div><div id="medium"></div><div id="hard"></div><div></div><div id="mines">10</div><div id="timer">00:00</div></div><div id="game"></div>',2),v=[u];function y(e,t,s,i,o,a){return c(),d("div",g,v)}const E=h(f,[["render",y]]);export{E as default};
