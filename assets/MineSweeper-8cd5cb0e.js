import{_ as h,f as c,g as d,x as p}from"./index-990b531e.js";const f={data(){return{oGame:null,oTemp:null,map:[],state:"loading",row:9,col:9,mines:10,mapCount:0,mapTimer:null,startTime:0,startTimer:null}},methods:{initMap(t=9,e=9,s=10){this.map=[],this.row=t,this.col=e,this.mines=s,this.state="loading",document.getElementById("mines").innerHTML=this.mines,clearInterval(this.startTimer),document.getElementById("timer").innerHTML="00:00",this.oGame.className="",this.oGame.innerHTML="",document.documentElement.style.setProperty("--ms-base",t>9?"2.4":"2"),document.documentElement.style.setProperty("--ms-row",t),document.documentElement.style.setProperty("--ms-col",e),clearInterval(this.mapTimer),this.mapCount=0,this.mapTimer=setInterval(()=>{if(this.mapCount>=t)return this.state="loaded",this.generateMines(),clearInterval(this.mapTimer);const i=document.createDocumentFragment(),o=[];for(let a=0;a<e;a++){const n=document.createElement("div");n.className="state-loading",n.addEventListener("animationend",function l(){n.className="state-closed",n.removeEventListener("animationend",l)}),n.pos=[this.mapCount,a],o.push({isOpen:!1,isCheck:!1,isExplode:!1,sign:"normal",type:0}),i.appendChild(n)}this.map.push(o),this.oGame.appendChild(i),this.mapCount++},100)},findPos([t,e]){return[[t-1,e-1],[t-1,e],[t-1,e+1],[t,e-1],[t,e+1],[t+1,e-1],[t+1,e],[t+1,e+1]].filter(([i,o])=>!(i<0||o<0||i>=this.row||o>=this.col))},findPosUDLR([t,e]){return[[t-1,e],[t+1,e],[t,e-1],[t,e+1]].filter(([i,o])=>!(i<0||o<0||i>=this.row||o>=this.col))},generateMines(){let t=[];for(;t.length!==this.mines;)t=[...new Set([...t,Math.floor(Math.random()*this.row*this.col)])];for(let e=0;e<t.length;e++){const s=Math.floor(t[e]/this.col),i=t[e]%this.col;t[e]=[s,i],this.map[s][i].type=9}for(let e=0;e<t.length;e++){const s=this.findPos(t[e]);for(let i=0;i<s.length;i++){const o=this.map[s[i][0]][s[i][1]];o.type!==9&&o.type++}}},handleClick(t){this.state!=="ongoing"&&(this.state="ongoing",this.startTime=+new Date,this.startInterval());const e=this.map[t.pos[0]][t.pos[1]];e.isOpen=!0,e.isCheck=!0,t.className="state-"+e.type,e.type===0?this.handleSpace(t.pos):e.type===9&&this.handleMines([t.pos]),this.judgeVictory()},explodeMines(t){setTimeout(()=>{if(this.map.length==0)return;const e=this.findPosUDLR(t);for(let s=0;s<e.length;s++){const[i,o]=e[s],a=this.map[i][o];if(a.isExplode===!1&&a.sign!=="flag"){a.isExplode=!0;const n=this.oGame.children[i*this.col+o];a.type===9?(a.isOpen=!0,n.className="state-over"):a.isOpen||(n.className="state-explode",n.addEventListener("animationend",function l(){n.className="state-closed",n.removeEventListener("animationend",l)})),this.explodeMines(e[s])}}},100)},handleMines(t){this.state="over",this.oGame.className="fail",clearInterval(this.startTimer);for(let e=0;e<this.map.length;e++)for(let s=0;s<this.map[e].length;s++)this.map[e][s].type===9&&this.map[e][s].sign!=="flag"&&(this.oGame.children[e*this.col+s].className="state-9"),this.map[e][s].type!==9&&this.map[e][s].sign==="flag"&&(this.oGame.children[e*this.col+s].className="state-flag-error");for(let e=0;e<t.length;e++){const[s,i]=t[e],o=this.map[s][i];o.isOpen=!0,o.isExplode=!0;const a=this.oGame.children[s*this.col+i];a.className="state-over";let n=this;a.addEventListener("animationend",function l(){n.explodeMines(t[e]),a.removeEventListener("animationend",l)})}},handleSpace(t){const e=this.findPos(t);for(let s=0;s<e.length;s++){const[i,o]=e[s],a=this.map[i][o];if(a.isCheck===!1&&a.sign==="normal"){a.isOpen=!0,a.isCheck=!0;const n=this.oGame.children[i*this.col+o];if(n.className="state-"+a.sign+"-down",n.addEventListener("animationend",function l(){n.className="state-"+a.type,n.removeEventListener("animationend",l)}),a.type>0&&a.type<9)continue;a.type===0&&this.handleSpace(e[s])}}},handleNumber(t,e){const s=this.findPos(t);let i=0;const o=[],a=[];for(let n=0;n<s.length;n++){const[l,r]=s[n],m=this.map[l][r];m.sign==="flag"&&(i++,o.push({...m,pos:s[n]})),m.type===9&&a.push({...m,pos:s[n]})}if(i>=e)if(JSON.stringify(o)===JSON.stringify(a))this.handleSpace(t);else{for(let n=0;n<o.length;n++)o[n].type!==9&&(this.oGame.children[o[n].pos[0]*this.col+o[n].pos[1]].className="state-flag-error");this.handleMines(a.filter(n=>n.sign!=="flag").map(n=>n.pos))}},judgeVictory(){let t=0,e=0;for(let s=0;s<this.map.length;s++)for(let i=0;i<this.map[s].length;i++)this.map[s][i].isOpen===!1&&t++,this.map[s][i].sign==="flag"&&e++;t===e+this.mines&&(this.state="over",this.oGame.className="success",clearInterval(this.startTimer))},startInterval(){const t=document.getElementById("timer");this.startTimer=setInterval(()=>{const e=Math.floor((+new Date-this.startTime)/1e3),s=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),i=e%60<10?"0"+e%60:e%60;t.innerHTML=s+":"+i},1e3)}},created(){},mounted(){this.oGame=document.getElementById("game"),this.initMap(),document.getElementById("simple").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap()}),document.getElementById("medium").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap(16,16,40)}),document.getElementById("hard").addEventListener("click",()=>{this.state==="ongoing"&&confirm("正在游戏，是否重新开始？")===!1||this.initMap(16,30,99)}),document.oncontextmenu=()=>!1,this.oGame.addEventListener("mousedown",t=>{if(this.oGame===t.target||["loading","over"].includes(this.state))return;const[e,s]=t.target.pos;this.map[e][s].isOpen===!1&&(this.oTemp=t.target,this.oTemp.className="state-"+this.map[e][s].sign+"-down")}),this.oGame.addEventListener("mousemove",t=>{this.oTemp&&this.oTemp!==t.target&&(this.oTemp.className.match(/state\-.+\-down/)&&(this.oTemp.className=this.oTemp.className.replace("-down","-up")),this.oTemp=null)}),this.oGame.addEventListener("mouseup",t=>{if(this.oTemp!==t.target){this.oTemp=null;return}const[e,s]=t.target.pos;t.button===0&&(this.map[e][s].sign==="normal"?this.handleClick(this.oTemp):this.oTemp.className="state-"+this.map[e][s].sign+"-up"),t.button===2&&(this.map[e][s].sign={flag:"question",normal:"flag",question:"normal"}[this.map[e][s].sign],this.map[e][s].sign==="flag"&&(this.mines-=1),this.map[e][s].sign==="question"&&(this.mines+=1),document.getElementById("mines").innerHTML=this.mines,this.oTemp.className="state-"+this.map[e][s].sign+"-up"),this.oTemp=null}),this.oGame.addEventListener("dblclick",t=>{if(this.oGame===t.target)return;const[e,s]=t.target.pos,i=this.map[e][s];i.isOpen&&i.type>0&&i.type<9&&(this.handleNumber([e,s],i.type),this.judgeVictory())})},beforeUnmount(){document.oncontextmenu=()=>!0}},u={class:"w-full compel-screen overflow-scroll"},g=p('<div class="minesweeper"><div class="action"><div id="simple"></div><div id="medium"></div><div id="hard"></div><div></div><div id="mines">10</div><div id="timer">00:00</div></div><div id="game"></div></div>',1),v=[g];function y(t,e,s,i,o,a){return c(),d("div",u,v)}const E=h(f,[["render",y]]);export{E as default};
